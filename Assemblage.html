<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<link rel="stylesheet" href="style.css" type="text/css">
<meta content="text/html; charset=iso-8859-1" http-equiv="Content-Type">
<link rel="Start" href="index.html">
<link rel="Up" href="index.html">
<link title="Index of types" rel=Appendix href="index_types.html">
<link title="Index of values" rel=Appendix href="index_values.html">
<link title="Index of modules" rel=Appendix href="index_modules.html">
<link title="Assemblage" rel="Chapter" href="Assemblage.html"><link title="Features and flags" rel="Section" href="#featuresandflags">
<link title="Resolvers" rel="Section" href="#resolvers">
<link title="Custom Actions" rel="Section" href="#actions">
<link title="Components" rel="Section" href="#comps">
<link title="Component helpers" rel="Section" href="#componenthelpers">
<link title="Projects" rel="Section" href="#projects">
<link title="Build Environments" rel="Section" href="#buildenv">
<link title="Tools" rel="Section" href="#tools">
<title>Assemblage</title>
</head>
<body>
<div class="navbar">&nbsp;<a class="up" href="index.html" title="Index">Up</a>
&nbsp;</div>
<h1>Module <a href="type_Assemblage.html">Assemblage</a></h1>

<pre><span class="keyword">module</span> Assemblage: <code class="code"><span class="keyword">sig</span></code> <a href="Assemblage.html">..</a> <code class="code"><span class="keyword">end</span></code></pre><div class="info module top">
The Assemblage Library.
<p>

    <code class="code"><span class="constructor">Assemblage</span></code> provides a simple embedded domain specific language
    to describe <code class="code"><span class="constructor">OCaml</span></code> projects. It also provides simple
    <a href="Assemblage.html#tools">tools</a> to configure, manage, install and use OCaml
    projects.
<p>

    Describing a project eventually leads to describe its build
    artifacts. The exact mapping betweem project elements and those
    build artifacts depends on the presence or absence of
    <a href="Assemblage.Features.html">features</a>. Examples of such features are weather to
    compile and run the tests (user-defined feature), the presence of
    the native compiler (system-dependant feature), compiling a
    library using <code class="code">async</code> or <code class="code">lwt</code> as a backend (environment-dependant
    feature), ...
<p>

    Finally, generating build artifacts means refining the project
    description into concrete <a href="Assemblage.Flags.html">command line arguments</a> to pass
    to the different compilers (<code class="code">ocamlc</code>, <code class="code">ocamlopt</code>) on the different
    compilation and linking phases.
<p>

    <em>Release %%VERSION%% - %%AUTHOR%% </em><br>
</div>
<hr width="100%">
<br>
<h1 id="featuresandflags">Features and flags</h1><br>

<pre><span class="keyword">module</span> <a href="Assemblage.Features.html">Features</a>: <code class="code"><span class="keyword">sig</span></code> <a href="Assemblage.Features.html">..</a> <code class="code"><span class="keyword">end</span></code></pre><div class="info">
Features.
</div>

<pre><span class="keyword">module</span> <a href="Assemblage.Flags.html">Flags</a>: <code class="code"><span class="keyword">sig</span></code> <a href="Assemblage.Flags.html">..</a> <code class="code"><span class="keyword">end</span></code></pre><div class="info">
Flags
</div>
<br>
<h1 id="resolvers">Resolvers</h1><br>
<br>
A project defines different kinds of names: local and external
    library names. A local library name needs to be associated with
    the name of the local directory where the build artifacts for that
    library are created and an external library name needs to be
    associated with the global directory where the object files for
    that library are installed.<br>

<pre><span class="keyword">module</span> <a href="Assemblage.Resolver.html">Resolver</a>: <code class="code"><span class="keyword">sig</span></code> <a href="Assemblage.Resolver.html">..</a> <code class="code"><span class="keyword">end</span></code></pre><br>
<h1 id="actions">Custom Actions</h1><br>

<pre><span class="keyword">module</span> <a href="Assemblage.Action.html">Action</a>: <code class="code"><span class="keyword">sig</span></code> <a href="Assemblage.Action.html">..</a> <code class="code"><span class="keyword">end</span></code></pre><br>
<h1 id="comps">Components</h1>
<p>

    A project is a set of components. Each component describes a
    logical build unit like a compilation unit, a library, a binary, a
    test, the documentation of a library, etc. A component can depend
    on other components, either because it needs the dependencies to
    be part of it or because it needs them to be build.<br>

<pre><span id="TYPEcomp_unit"><span class="keyword">type</span> <code class="type"></code>comp_unit</span> </pre>
<div class="info ">
The type for compilation unit descriptions.<br>
</div>


<pre><span id="TYPEother"><span class="keyword">type</span> <code class="type"></code>other</span> </pre>
<div class="info ">
The type for arbitrarily constructed files descriptions.<br>
</div>


<pre><span id="TYPEc"><span class="keyword">type</span> <code class="type"></code>c</span> </pre>
<div class="info ">
The type for C source file descriptions.<br>
</div>


<pre><span id="TYPEjs"><span class="keyword">type</span> <code class="type"></code>js</span> </pre>
<div class="info ">
The type for <code class="code">js_of_ocaml</code> artifact descriptions.<br>
</div>


<pre><span id="TYPEpkg"><span class="keyword">type</span> <code class="type"></code>pkg</span> </pre>
<div class="info ">
The type for package descriptions.<br>
</div>


<pre><span id="TYPElib"><span class="keyword">type</span> <code class="type"></code>lib</span> </pre>
<div class="info ">
The type for library descriptions.<br>
</div>


<pre><span id="TYPEbin"><span class="keyword">type</span> <code class="type"></code>bin</span> </pre>
<div class="info ">
The type for binary executable descriptions.<br>
</div>


<pre><span id="TYPEdir"><span class="keyword">type</span> <code class="type"></code>dir</span> </pre>
<div class="info ">
The type for directory of artifacts descriptions.<br>
</div>


<pre><span id="TYPEtest"><span class="keyword">type</span> <code class="type"></code>test</span> </pre>
<div class="info ">
The type for test descriptions.<br>
</div>


<pre><span id="TYPEcomponent"><span class="keyword">type</span> <code class="type"></code>component</span> = <code class="type">[ `Bin of <a href="Assemblage.html#TYPEbin">bin</a><br>       | `C of <a href="Assemblage.html#TYPEc">c</a><br>       | `Dir of <a href="Assemblage.html#TYPEdir">dir</a><br>       | `JS of <a href="Assemblage.html#TYPEjs">js</a><br>       | `Lib of <a href="Assemblage.html#TYPElib">lib</a><br>       | `Other of <a href="Assemblage.html#TYPEother">other</a><br>       | `Pkg of <a href="Assemblage.html#TYPEpkg">pkg</a><br>       | `Test of <a href="Assemblage.html#TYPEtest">test</a><br>       | `Unit of <a href="Assemblage.html#TYPEcomp_unit">comp_unit</a> ]</code> </pre>
<div class="info ">
The type for components.
    <ul>
<li><code class="code"><span class="keywordsign">`</span><span class="constructor">Unit</span> u</code> u is a project compilation unit.</li>
<li><code class="code"><span class="keywordsign">`</span><span class="constructor">Lib</span> l</code> is a project library.</li>
<li><code class="code"><span class="keywordsign">`</span><span class="constructor">Bin</span> b</code> is a project binary.</li>
<li><code class="code"><span class="keywordsign">`</span><span class="constructor">Test</span> b</code> is a project test.</li>
<li><code class="code"><span class="keywordsign">`</span><span class="constructor">Pkg</span> p</code> is an external named package.</li>
<li>FIXME</li>
</ul>
<br>
</div>


<pre><span id="VALunit"><span class="keyword">val</span> unit</span> : <code class="type">?available:<a href="Assemblage.Features.html#TYPEt">Features.t</a> -><br>       ?flags:<a href="Assemblage.Flags.html#TYPEt">Flags.t</a> -><br>       ?deps:<a href="Assemblage.html#TYPEcomponent">component</a> list -><br>       ?dir:string -> string -> [> `Unit of <a href="Assemblage.html#TYPEcomp_unit">comp_unit</a> ]</code></pre><div class="info ">
<code class="code">unit name ~dir ~available ~flags ~deps</code> is a compilation unit
    named <code class="code">name</code> (the filename without extension) present in directory <code class="code">dir</code>.
    It is only available whenever <code class="code">available</code> is true,
    it must be build with <code class="code">flags</code> and depends on <code class="code">deps</code> to be built.<br>
</div>

<pre><span id="VALother"><span class="keyword">val</span> other</span> : <code class="type">?available:<a href="Assemblage.Features.html#TYPEt">Features.t</a> -><br>       ?flags:<a href="Assemblage.Flags.html#TYPEt">Flags.t</a> -><br>       ?deps:<a href="Assemblage.html#TYPEcomponent">component</a> list -><br>       ?action:<a href="Assemblage.Action.html#TYPEt">Action.t</a> -><br>       string -> [ `C | `Ml | `Mli ] list -> [> `Other of <a href="Assemblage.html#TYPEother">other</a> ]</code></pre><div class="info ">
Generated OCaml source file(s). The custom action get the name of
    the build dir as argument.<br>
</div>

<pre><span id="VALc"><span class="keyword">val</span> c</span> : <code class="type">?available:<a href="Assemblage.Features.html#TYPEt">Features.t</a> -><br>       ?flags:<a href="Assemblage.Flags.html#TYPEt">Flags.t</a> -><br>       ?deps:<a href="Assemblage.html#TYPEcomponent">component</a> list -><br>       ?dir:string -><br>       ?link_flags:string list -> string -> string list -> [> `C of <a href="Assemblage.html#TYPEc">c</a> ]</code></pre><div class="info ">
<code class="code">c name deps libs</code> is the C file <code class="code">name.c</code>, which need the C
    libraries <code class="code">libs</code> to be compiled -- and it has the dependencies
    <code class="code">deps</code>.<br>
</div>

<pre><span id="VALlib"><span class="keyword">val</span> lib</span> : <code class="type">?available:<a href="Assemblage.Features.html#TYPEt">Features.t</a> -><br>       ?flags:<a href="Assemblage.Flags.html#TYPEt">Flags.t</a> -><br>       ?deps:<a href="Assemblage.html#TYPEcomponent">component</a> list -><br>       ?pack:bool -><br>       ?c:[ `C of <a href="Assemblage.html#TYPEc">c</a> ] list -><br>       string -><br>       [ `Unit of <a href="Assemblage.html#TYPEcomp_unit">comp_unit</a> ] list -> [> `Lib of <a href="Assemblage.html#TYPElib">lib</a> ]</code></pre><div class="info ">
<code class="code">lib name units</code> is the project library <code class="code">name</code> composed by the compilation
    units <code class="code">cus</code>. If <code class="code">lib</code> is set, use <code class="code">ocamldep</code> to approximate the
    compilation units and their dependecies in the given directory.<br>
</div>

<pre><span id="VALlib_pp"><span class="keyword">val</span> lib_pp</span> : <code class="type">?available:<a href="Assemblage.Features.html#TYPEt">Features.t</a> -><br>       ?flags:<a href="Assemblage.Flags.html#TYPEt">Flags.t</a> -><br>       ?deps:<a href="Assemblage.html#TYPEcomponent">component</a> list -><br>       ?pack:bool -><br>       ?c:[ `C of <a href="Assemblage.html#TYPEc">c</a> ] list -><br>       string -><br>       [ `Unit of <a href="Assemblage.html#TYPEcomp_unit">comp_unit</a> ] list -> [> `Lib of <a href="Assemblage.html#TYPElib">lib</a> ]</code></pre><div class="info ">
<code class="code">lib_pp</code> is like <a href="Assemblage.html#VALlib"><code class="code"><span class="constructor">Assemblage</span>.lib</code></a> but it defines a project pre-processor.<br>
</div>

<pre><span id="VALbin"><span class="keyword">val</span> bin</span> : <code class="type">?available:<a href="Assemblage.Features.html#TYPEt">Features.t</a> -><br>       ?flags:<a href="Assemblage.Flags.html#TYPEt">Flags.t</a> -><br>       ?deps:<a href="Assemblage.html#TYPEcomponent">component</a> list -><br>       ?byte_only:bool -><br>       ?link_all:bool -><br>       ?install:bool -><br>       string -><br>       [ `Unit of <a href="Assemblage.html#TYPEcomp_unit">comp_unit</a> ] list -> [> `Bin of <a href="Assemblage.html#TYPEbin">bin</a> ]</code></pre><div class="info ">
<code class="code">bin name units</code> is the binary <code class="code">name</code> obtained by compiling
    the compilation units <code class="code">units</code>, with the dependencies <code class="code">deps</code>. By
    default, the source files are located into <i>bin/</i> (this is
    controled by the value of <code class="code">dir</code>).<br>
</div>

<pre><span id="VALdir"><span class="keyword">val</span> dir</span> : <code class="type">?available:As_features.t -><br>       ?flags:As_flags.t -><br>       ?deps:<a href="Assemblage.html#TYPEcomponent">component</a> list -><br>       ?install:bool -><br>       [ `Bin<br>       | `Doc<br>       | `Etc<br>       | `Lib<br>       | `Man<br>       | `Misc<br>       | `Other of string<br>       | `Sbin<br>       | `Share<br>       | `Share_root<br>       | `Stublibs<br>       | `Toplevel ] -> <a href="Assemblage.html#TYPEcomponent">component</a> list -> [> `Dir of <a href="Assemblage.html#TYPEdir">dir</a> ]</code></pre><div class="info ">
<code class="code">dir name ~available ~flags ~deps contents</code> is a directory named
    <code class="code">name</code> that contains the build artefacts of the component <code class="code">contents</code>.
    If <code class="code">install</code> is <code class="code"><span class="keyword">true</span></code> (default), the artifacts are installed in the
    corresponding directory under the install prefix. It is only available
    whenever <code class="code">available</code> is true, it must be build with <code class="code">flags</code> and
    depends on <code class="code">deps</code> and <code class="code">contents</code> to be built.<br>
</div>

<pre><span id="VALjs"><span class="keyword">val</span> js</span> : <code class="type">[ `Bin of <a href="Assemblage.html#TYPEbin">bin</a> ] -> string list -> [> `JS of <a href="Assemblage.html#TYPEjs">js</a> ]</code></pre><div class="info ">
<code class="code">js bin args</code> is the decription of a javascript artefact generated
    by <code class="code">js_of_ocaml</code>.<br>
</div>

<pre><span id="VALpkg"><span class="keyword">val</span> pkg</span> : <code class="type">?available:<a href="Assemblage.Features.html#TYPEt">Features.t</a> -><br>       ?flags:<a href="Assemblage.Flags.html#TYPEt">Flags.t</a> -><br>       ?opt:bool -> string -> [> `Pkg of <a href="Assemblage.html#TYPEpkg">pkg</a> ]</code></pre><div class="info ">
<code class="code">pkg available opt name</code> is an external OCaml package named <code class="code">name</code>. It is
    only available whenever <code class="code">available</code> is true. If <code class="code">opt</code> is true (defaults
    to <code class="code"><span class="keyword">false</span></code>) a feature <code class="code">f</code> is automatically created for the package
    and anded to <code class="code">available</code>.<br>
</div>

<pre><span id="VALpkg_pp"><span class="keyword">val</span> pkg_pp</span> : <code class="type">?available:<a href="Assemblage.Features.html#TYPEt">Features.t</a> -><br>       ?flags:<a href="Assemblage.Flags.html#TYPEt">Flags.t</a> -><br>       ?opt:bool -> string -> [> `Pkg of <a href="Assemblage.html#TYPEpkg">pkg</a> ]</code></pre><div class="info ">
<code class="code">pkg_pp available opt name</code> is like <a href="Assemblage.html#VALpkg"><code class="code"><span class="constructor">Assemblage</span>.pkg</code></a> except it denotes
    an external OCaml pre-processor package.<br>
</div>

<pre><span id="VALpkg_c"><span class="keyword">val</span> pkg_c</span> : <code class="type">?available:<a href="Assemblage.Features.html#TYPEt">Features.t</a> -><br>       ?flags:<a href="Assemblage.Flags.html#TYPEt">Flags.t</a> -><br>       ?opt:bool -> string -> [> `Pkg of <a href="Assemblage.html#TYPEpkg">pkg</a> ]</code></pre><div class="info ">
<code class="code">pkg_c available opt name</code> is like <a href="Assemblage.html#VALpkg"><code class="code"><span class="constructor">Assemblage</span>.pkg</code></a> except it denotes an
    external C package.<br>
</div>

<pre><span id="TYPEtest_command"><span class="keyword">type</span> <code class="type"></code>test_command</span> </pre>
<div class="info ">
The type for test commands.<br>
</div>


<pre><span id="TYPEtest_args"><span class="keyword">type</span> <code class="type"></code>test_args</span> = <code class="type">(<a href="Assemblage.html#TYPEcomponent">component</a> -> string) -> string list</code> </pre>
<div class="info ">
The type for command line arguments when calling tests of executable.<br>
</div>


<pre><span id="VALtest_bin"><span class="keyword">val</span> test_bin</span> : <code class="type">[ `Bin of <a href="Assemblage.html#TYPEbin">bin</a> ] -><br>       ?args:<a href="Assemblage.html#TYPEtest_args">test_args</a> -> unit -> <a href="Assemblage.html#TYPEtest_command">test_command</a></code></pre><div class="info ">
A test which runs a binary built in the project.<br>
</div>

<pre><span id="VALtest_shell"><span class="keyword">val</span> test_shell</span> : <code class="type">('a, unit, string, <a href="Assemblage.html#TYPEtest_command">test_command</a>) Pervasives.format4 -> 'a</code></pre><div class="info ">
A test which runs an arbitrary shell command.<br>
</div>

<pre><span id="VALtest"><span class="keyword">val</span> test</span> : <code class="type">?available:<a href="Assemblage.Features.html#TYPEt">Features.t</a> -><br>       ?flags:<a href="Assemblage.Flags.html#TYPEt">Flags.t</a> -><br>       ?deps:<a href="Assemblage.html#TYPEcomponent">component</a> list -><br>       ?dir:string -><br>       string -> <a href="Assemblage.html#TYPEtest_command">test_command</a> list -> [> `Test of <a href="Assemblage.html#TYPEtest">test</a> ]</code></pre><div class="info ">
Description of a test.<br>
</div>
<br>
<h1 id="componenthelpers">Component helpers</h1><br>

<pre><span id="VALocamldep"><span class="keyword">val</span> ocamldep</span> : <code class="type">?keep:(string -> bool) -><br>       ?deps:(string -> <a href="Assemblage.html#TYPEcomponent">component</a> list) -><br>       ?unit:(string -><br>              <a href="Assemblage.html#TYPEcomponent">component</a> list -> [ `Unit of <a href="Assemblage.html#TYPEcomp_unit">comp_unit</a> ]) -><br>       dir:string -> unit -> [> `Unit of <a href="Assemblage.html#TYPEcomp_unit">comp_unit</a> ] list</code></pre><div class="info ">
<code class="code">ocamldep ~dir ~keep ~deps ~unit ()</code> is the list of compilation
    units derived as follows.
<p>

    First the set of compilation unit names is derived by looking for
    any ml and mli files in <code class="code">dir</code>. This set is then filtered by
    keeping only the unit names that satisfy the <code class="code">keep</code> predicate
    (defaults to <code class="code"><span class="keyword">fun</span> _ <span class="keywordsign">-&gt;</span> <span class="keyword">true</span></code>).
<p>

    For each found compilation name <code class="code">n</code> a first set of dependencies is
    determined by calling <code class="code">deps n</code> (e.g. to specify packages and
    pre-processors). ocamldep is then invoked and the resulting
    compilation units are constructed by <code class="code">unit n deps'</code> where <code class="code">deps'</code>
    is the union of deps found by ocamldep and <code class="code">deps n</code> (<code class="code">unit</code>
    defaults to <code class="code"><span class="keyword">fun</span> n deps' <span class="keywordsign">-&gt;</span> unit ~dir n deps'</code>).<br>
</div>

<pre><span id="VALcstubs"><span class="keyword">val</span> cstubs</span> : <code class="type">?available:<a href="Assemblage.Features.html#TYPEt">Features.t</a> -><br>       ?dir:string -><br>       ?headers:string list -><br>       ?cflags:string list -><br>       ?clibs:string list -><br>       string -> <a href="Assemblage.html#TYPEcomponent">component</a> list -> [> `Lib of <a href="Assemblage.html#TYPElib">lib</a> ]</code></pre><div class="info ">
<code class="code">stubs name deps</code> is the C stub generations, using Ctypes, of the
    compilation unit <code class="code">name</code>.<br>
</div>
<br>
<h1 id="projects">Projects</h1><br>

<pre><span id="TYPEt"><span class="keyword">type</span> <code class="type"></code>t</span> </pre>
<div class="info ">
The type for OCaml projects descriptions. Simply a set of
    components.<br>
</div>


<pre><span id="VALcreate"><span class="keyword">val</span> create</span> : <code class="type">?available:<a href="Assemblage.Features.html#TYPEt">Features.t</a> -><br>       ?flags:<a href="Assemblage.Flags.html#TYPEt">Flags.t</a> -><br>       ?doc_css:string -><br>       ?doc_intro:string -><br>       ?doc_dir:string -><br>       ?doc_public:string list -><br>       ?version:string -> string -> <a href="Assemblage.html#TYPEcomponent">component</a> list -> <a href="Assemblage.html#TYPEt">t</a></code></pre><div class="info ">
<code class="code">create name deps</code> registers the project named <code class="code">name</code>, defining
    the libraries, binaries and tests defined by the transitive
    closure of objects in <code class="code">deps</code>.<br>
</div>

<pre><span id="VALadd"><span class="keyword">val</span> add</span> : <code class="type"><a href="Assemblage.html#TYPEt">t</a> -> unit</code></pre><div class="info ">
<code class="code">add t</code> registers the project <code class="code">t</code> for use by the assemblage
    command line tools.<br>
</div>
<br>
<h1 id="buildenv">Build Environments</h1><br>

<pre><span class="keyword">module</span> <a href="Assemblage.Build_env.html">Build_env</a>: <code class="code"><span class="keyword">sig</span></code> <a href="Assemblage.Build_env.html">..</a> <code class="code"><span class="keyword">end</span></code></pre><br>
<h1 id="tools">Tools</h1><br>

<pre><span id="TYPEtool"><span class="keyword">type</span> <code class="type"></code>tool</span> = <code class="type"><a href="Assemblage.html#TYPEt">t</a> -> <a href="Assemblage.Build_env.html#TYPEt">Build_env.t</a> -> unit</code> </pre>
<div class="info ">
The signature of tools.<br>
</div>


<pre><span id="VALprocess"><span class="keyword">val</span> process</span> : <code class="type">?file:string -> string -> <a href="Assemblage.html#TYPEtool">tool</a> -> unit</code></pre><div class="info ">
<code class="code">process ~file name fn</code> reads and processes the OCaml <code class="code">file</code> in a
    top-level environment (the default is <code class="code">assemble.ml</code>), for the
    project called <code class="code">name</code>, and apply <code class="code">fn</code> to the projects registered
    as side-effects.<br>
</div>

<pre><span id="VALconfigure"><span class="keyword">val</span> configure</span> : <code class="type">[ `Make ] -> <a href="Assemblage.html#TYPEtool">tool</a></code></pre><div class="info ">
Configure the project by generating the build, META and .install
    files, using the given build system backend (currently, only GNU
    make is supported).<br>
</div>

<pre><span id="VALdescribe"><span class="keyword">val</span> describe</span> : <code class="type"><a href="Assemblage.html#TYPEtool">tool</a></code></pre><div class="info ">
Describe the project to stdout.<br>
</div>
</body></html>